---
title: Эффективная конкатенация строк
description: Кристофер Чедоу пару лет назад написал пост про особенности реализации конкатенации строк
date: 2020-01-03
url: https://blog.vjeux.com/2018/javascript/efficient-string-encoding-for-concatenation.html
tags:
  - performance
  - js
  - internals
layout: layouts/post.njk
---
В конце октября в код Hermes (JavaScript-движок от Facebook, который используется в React Native на Android) был влит код с оптимизацией конкатенации строк.

Простая реализация конкатенации может привести к квадратичной сложности из-за копирования строк, поэтому в современных движках (например, в v8) для конкатенации строк используется дерево-подобная структура — rope. У этого подхода есть накладные расходы — для одного символа может выделяться один объект. В Hermes используется другой подход. Для конкатенации используется специальный буфер, куда добавляются все строки. Новая оптимизация ускорила pdfjs в три раза.

Если есть возможность можно помочь движку с конкатенацией, переписав код. Кристофер Чедоу пару лет назад написал пост про особенности реализации конкатенации строк — "Efficient String Encoding for Concatenation". Там он предлагает заменить конкатенацию строк join'ом массива строк (устаревший совет). Потенциально это может ускорить код, который очень активно работает со строками.

https://blog.vjeux.com/2018/javascript/efficient-string-encoding-for-concatenation.html
https://github.com/facebook/hermes/commit/fc2674b1ed207fb5967f75d1159e5f0b8c46fa8d
