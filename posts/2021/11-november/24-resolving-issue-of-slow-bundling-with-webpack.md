---
title: Поиск причины деградации времени сборки Webpack 5
description: Оуэн Хэннесси поделился историей поиска бага, из-за которого время запуска dev-сервера замедлилось в пятнадцать раз
date: 2021-11-24
url: https://engineering.tines.com/blog/understanding-why-our-build-got-15x-slower-with-webpack
tags:
  - v8 
  - performance 
  - webpack
layout: layouts/post.njk
---
Оуэн Хэннесси поделился историей поиска бага, из-за которого время запуска dev-сервера Webpack замедлилось в пятнадцать раз — "Understanding why our build got 15x slower with Webpack 5".

Проблема возникла после добавления невинной тёмной темы. Первые подозрения упали на CSS-in-JS-библиотеку Linaria. С помощью профилировщика внутри библиотеки была найдена проблемная функция, в которой использовался метод массива `.concat()`. Переписывание кода без использования `.concat()` решило проблему. Однако оставались вопросы, из-за того что в оригинальном коде просадки скорости не было при сборке проекта с помощью Webpack 4. Надо было исследовать исходники V8.

В V8 у метода `.concat()` есть две ветки выполнения кода — медленная и быстрая. Медленная ветка начинает работать в том случае, если движок хотя бы один раз устанавливал `Symbol.isConcatSpreadable`. В Webpack 5 это происходило в коде, отвечающем за обратную совместимость с четвёртой версией. Для решения проблемы разработчики Webpack добавили экспериментальную опцию `backCompat`, которая полностью отключает обратную совместимость, избавляясь от ещё большего количества проблемного кода.

https://engineering.tines.com/blog/understanding-why-our-build-got-15x-slower-with-webpack
