---
title: Взаимодействие с веб-воркером без прерывания цикла событий
description: Михай Парпарита поделился эффективным способом общения с веб-воркером без использования SharedArrayBuffer
date: 2021-08-25
url: https://blog.persistent.info/2021/08/worker-loop.html
tags:
  - api
  - webworkers
layout: layouts/post.njk
---
Михай Парпарита поделился эффективным способом общения с веб-воркером без использования `SharedArrayBuffer` — "Communicating With a Web Worker Without Yielding To The Event Loop".

Автор статьи работал над веб-версией эмулятора ОС старых Макинтошей. Архитектура эмулятора разделена на две основные части: UI и поток эмуляции, работающий в веб-воркере. Чтобы эмуляция работала плавно, для обмена данными между UI и веб-воркером используется `SharedArrayBuffer`. Поддержка `SharedArrayBuffer` на данный момент отключена в Safari. Михай нашёл альтернативное решение.

Веб-воркер может подгружать дополнительный код с помощью `importScrips`. `importScripts` работает синхронно, открывая возможность передачи команд из основного потока с помощью динамически формируемого JavaScript-кода. JavaScript-код создаётся внутри сервис-воркера и сохраняется в файл, который в цикле загружается в веб-воркере.

Такой подход медленнее `SharedArrayBuffer`, но быстрее решения с остановкой цикла событий и позволяет достичь хорошей отзывчивости ввода в эмуляторе.

https://blog.persistent.info/2021/08/worker-loop.html
